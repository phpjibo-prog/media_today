{% extends 'base.html' %}

{% block content %}
<h1>Upload a New MP3 Track</h1>

<!-- Display Flash Messages (including the 'error' message from app.py) -->
{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
{% for category, message in messages %}
<!-- The category 'error' is passed from app.py, coloring the message red via CSS -->
<div class="alert alert-{{ category }}">
    {{ message }}
    {% if category == 'error' %}
    <p>You can login with:</p>
    <!-- Links to trigger the simulated logins -->
    <a href="{{ url_for('login_simulation') }}?provider=google" class="social-login">Google</a> |
    <a href="{{ url_for('login_simulation') }}?provider=facebook" class="social-login">Facebook</a> |
    <a href="{{ url_for('login_simulation') }}?provider=instagram" class="social-login">Instagram</a>
    {% endif %}
</div>
{% endfor %}
{% endif %}
{% endwith %}

<!-- ... rest of the HTML structure for the <details> form ... -->
<div class="upload-container-wrapper">
    <details class="upload-dropdown-class" {% if logged_in %}open{% endif %}>
        <summary>Add MP3 to Track</summary>

        <div class="dropdown-form-content">
            {% if logged_in %}
            <!-- The actual form only shows if logged in -->
            <form action="/upload-mp3" method="POST" enctype="multipart/form-data" class="center-form">
                <label for="track_name">Track Name:</label>
                <input type="text" id="track_name" name="track_name" required>
                <label for="mp3_file">Upload MP3 File:</label>
                <input type="file" id="mp3_file" name="mp3_file" accept=".mp3" required>
                <button type="submit">Upload Track</button>
            </form>
            {% else %}
            <!-- This static message is displayed if the 'flash' message above is missed -->
            <p style="color:red; text-align: center;">Login first to use the upload form.</p>
            {% endif %}
        </div>
    </details>
</div>

{% endblock %}